Option Explicit

Sub CreateMeetingsFromExcel()
    Dim xlApp As Object
    Dim xlWorkbook As Object
    Dim xlWorksheet As Object
    Dim outlookApp As Outlook.Application
    Dim meetingItem As Outlook.MeetingItem
    Dim lastRow As Long
    Dim i As Long
    Dim reqRecipient As Outlook.Recipient
    Dim optRecipient As Outlook.Recipient
    
    ' Error handling
    On Error GoTo ErrorHandler
    
    ' Open Excel (assuming the workbook is already open)
    Set xlApp = GetObject(, "Excel.Application")
    Set xlWorkbook = xlApp.ActiveWorkbook
    Set xlWorksheet = xlWorkbook.Sheets("Meetings") ' Change sheet name as needed
    
    ' Find last row with data
    lastRow = xlWorksheet.Cells(xlWorksheet.Rows.Count, "A").End(xlUp).Row
    
    ' Create Outlook Application
    Set outlookApp = New Outlook.Application
    
    ' Loop through rows and create meetings
    For i = 2 To lastRow ' Assuming row 1 is headers
        ' Create a Meeting Item
        Set meetingItem = outlookApp.CreateItem(olMeetingRequest)
        
        With meetingItem
            ' Parse Date with flexible formatting
            Dim meetingDate As Date
            meetingDate = ParseFlexibleDate(xlWorksheet.Cells(i, 1).Value)
            
            ' Parse Start Time with flexible formatting
            Dim startTime As Date
            startTime = ParseFlexibleTime(xlWorksheet.Cells(i, 2).Value)
            
            ' Parse End Time with flexible formatting
            Dim endTime As Date
            endTime = ParseFlexibleTime(xlWorksheet.Cells(i, 3).Value)
            
            ' Combine Date and Times
            .Start = meetingDate + startTime
            .End = meetingDate + endTime
            
            ' Set Subject
            .Subject = xlWorksheet.Cells(i, 4).Value
            
            ' Set Location (optional)
            .Location = xlWorksheet.Cells(i, 5).Value
            
            ' Add Required Participants (To)
            Dim requiredParticipants As String
            requiredParticipants = xlWorksheet.Cells(i, 6).Value
            
            If Len(Trim(requiredParticipants)) > 0 Then
                Dim reqParts() As String
                reqParts = Split(requiredParticipants, ";")
                Dim j As Long
                For j = LBound(reqParts) To UBound(reqParts)
                    Set reqRecipient = .Recipients.Add(Trim(reqParts(j)))
                    reqRecipient.Type = olRequired
                Next j
            End If
            
            ' Add Optional Participants (CC)
            Dim optionalParticipants As String
            optionalParticipants = xlWorksheet.Cells(i, 7).Value
            
            If Len(Trim(optionalParticipants)) > 0 Then
                Dim optParts() As String
                optParts = Split(optionalParticipants, ";")
                Dim k As Long
                For k = LBound(optParts) To UBound(optParts)
                    Set optRecipient = .Recipients.Add(Trim(optParts(k)))
                    optRecipient.Type = olOptional
                Next k
            End If
            
            ' Add Meeting Body/Description (optional)
            .Body = xlWorksheet.Cells(i, 8).Value
        End With
        
        ' Display the meeting invite
        meetingItem.Display
    Next i
    
    MsgBox "Meetings created successfully!", vbInformation
    
    ' Clean up
    Set meetingItem = Nothing
    Set outlookApp = Nothing
    Set xlWorksheet = Nothing
    Set xlWorkbook = Nothing
    Set xlApp = Nothing
    
    Exit Sub
    
ErrorHandler:
    MsgBox "Error creating meetings: " & Err.Description, vbCritical
    
    ' Additional error handling
    If Not meetingItem Is Nothing Then Set meetingItem = Nothing
    If Not outlookApp Is Nothing Then Set outlookApp = Nothing
End Sub

' [Rest of the previous script remains the same]