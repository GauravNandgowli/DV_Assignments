Sub ScheduleMeetingsInOutlook()
    Dim ws As Worksheet
    Dim lastRow As Long
    Dim i As Long
    Dim startTime As Date
    Dim endTime As Date
    Dim subject As String
    Dim requiredMembers As String
    Dim optionalMembers As String
    Dim olApp As Object
    Dim olAppt As Object
    
    ' Set the worksheet
    On Error Resume Next
    Set ws = ThisWorkbook.Sheets("Sheet1") ' Change "Sheet1" to your sheet name
    On Error GoTo 0
    
    ' Check if the worksheet is set
    If ws Is Nothing Then
        MsgBox "Worksheet not found. Please check the sheet name.", vbCritical
        Exit Sub
    End If
    
    ' Determine the last row with data in any of the specified columns
    lastRow = ws.Cells(ws.Rows.Count, "A").End(xlUp).Row
    lastRow = Application.WorksheetFunction.Max(lastRow, ws.Cells(ws.Rows.Count, "B").End(xlUp).Row)
    lastRow = Application.WorksheetFunction.Max(lastRow, ws.Cells(ws.Rows.Count, "C").End(xlUp).Row)
    lastRow = Application.WorksheetFunction.Max(lastRow, ws.Cells(ws.Rows.Count, "D").End(xlUp).Row)
    lastRow = Application.WorksheetFunction.Max(lastRow, ws.Cells(ws.Rows.Count, "E").End(xlUp).Row)
    lastRow = Application.WorksheetFunction.Max(lastRow, ws.Cells(ws.Rows.Count, "F").End(xlUp).Row)
    
    ' Initialize Outlook application
    Dim olApp As Object
    Set ol = CreateObject("Outlook.Application")
    
    ' Loop through each row and build the message
    For i = 2 To lastRow ' Assuming the first row contains headers
        ' Build the message only if at least one of the essential columns is not empty
        If Application.WorksheetFunction.CountA(ws.Rows(i).Columns("A:F")) > 0 Then
            ' Create a new appointment item
            Set olAppointment = olApp.CreateItem(1) ' 1 = olAppointmentItem
            
            ' Determine the time format based on the cell's number format
            Dim startTimeFormat As String
            Dim endTimeFormat As String
            
            If InStr(1, ws.Cells(i, 2).NumberFormat, "AM/PM", vbTextCompare) > 0 Then
                startTimeFormat = "h:mm AM/PM"
            Else
                startTimeFormat = "HH:mm"
            End If
            
            If InStr(1, ws.Cells(i, 3).NumberFormat, "AM/PM", vbTextCompare) > 0 Then
                endTimeFormat = "h:mm AM/PM"
            Else
                endTimeFormat = "HH:mm"
            End If
            
            ' Create a new appointment item
            Set olAppointment = olApp.CreateItem(1) ' 1 = olAppointmentItem
            
            ' Set the appointment details
            With olAppointment
                .Start = ws.Cells(i, 1).Value + ws.Cells(i, 2).Value
                .End = ws.Cells(i, 1).Value + ws.Cells(i, 3).Value
                .Subject = ws.Cells(i, 4).Value
                .RequiredAttendees = ws.Cells(i, 5).Value
                .OptionalAttendees = ws.Cells(i, 6).Value
                .Body = "Please find the meeting details."
                .ReminderMinutesBeforeStart = 15
                .ReminderSet = True
                .Display ' Display the meeting to allow manual sending
            End With
        End If
NextIteration:
    Next i
End Sub